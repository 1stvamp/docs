<!DOCTYPE html> 
<html>
<!--Head-->
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Juju Documentation</title>
		<link href="https://fonts.googleapis.com/css?family=Ubuntu:400,300,300italic,400italic,700,700italic|Ubuntu+Mono" rel="stylesheet" type="text/css">
		<link rel="stylesheet" type="text/css" media="screen" href="http://juju.ubuntu.com/wp-content/themes/juju-website/css/reset.css">
 		<link rel="shortcut icon" href="http://assets.ubuntu.com/sites/ubuntu/latest/u/img/favicon.ico" />
		<link rel="stylesheet" type="text/css" media="screen" href="http://assets.ubuntu.com/sites/guidelines/css/latest/ubuntu-styles.css" />
		<link rel="stylesheet" type="text/css" media="screen" href="http://assets.ubuntu.com/sites/ubuntu/latest/u/css/global.css" />
		<link rel="stylesheet" type="text/css" media="screen" href="http://juju.ubuntu.com/wp-content/themes/juju-website/css/960.css">
		<link rel="stylesheet" type="text/css" media="screen" href="http://juju.ubuntu.com/wp-content/themes/juju-website/css/home-new.css">
		<link rel="stylesheet" id="stacktack-css" href="http://juju.ubuntu.com/wp-content/plugins/stacktack/css/stacktack.min.css?ver=3.4.2" type="text/css" media="all">
		<link href="https://juju.ubuntu.com/docs/css/main.css?1375975745" rel="stylesheet" type="text/css">
		
		<!--[if lt IE 9]>
		<script type="text/javascript" src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	</head>
<!--End-Head-->
  <body class="resources">
  	
<!--Header-->

	<header class="banner global" role="banner">
		<nav role="navigation" class="nav-primary nav-right">
			<div class="logo">
				<a class="logo-ubuntu" href="http://juju.canonicalwebteam.com/">
					<img width="118" height="27" src="http://assets.ubuntu.com/sites/ubuntu/latest/u/img/logo.png" alt="Juju logo" />
					<span>Juju</span>
				</a>
			</div>
			<ul>
				<li class="accessibility-aid"><a accesskey="s" href="#main-content">Jump to content</a></li>
				<li class="page_item page-item-8"><a href="http://juju.canonicalwebteam.com/charms/">Charms</a></li>
				<li class="page_item page-item-10"><a href="http://juju.canonicalwebteam.com/features/">Features</a></li>
				<li class="page_item page-item-12"><a href="http://juju.canonicalwebteam.com/deployment/">Deployment</a></li>
				<li class="page_item page-item-14"><a href="http://juju.canonicalwebteam.com/resources/">Resources</a></li>
				<li class="page_item page-item-16"><a href="http://juju.canonicalwebteam.com/community/">Community</a></li>
				<li class="page_item page-item-18"><a href="http://juju.canonicalwebteam.com/download/">Download</a></li>
			</ul>
			<div id="box-search">
				<form class="search-form" method="get" id="searchform" action="http://juju.canonicalwebteam.com/">
					<label class="off-left" for="s">Search:</label>
					<input class="form-text" type="text" value="" name="s" id="s" />
					<button class="off-left form-submit" type="submit" id="searchsubmit">Search</button>
				</form>		
			</div>
		</nav>	
	</header>
<!--End-Header-->

    <section id="content" class="container-12">
      <div class="grid-12 doc-container">
		<div id="navlinks" class="grid-3 doc-navigation">LINKS</div>
        <div class="grid-9 doc-content">
          <article>
            <section id ="best_practice">
            <h1>Best Practice for Charm Authors</h1>
            
            <p>This document is to capture charm best practices from the community. We expect devops to be strongly opinionated, therefore some strong opinions don't make sense as policy, but do make sense to share with others to disseminate expertise.</p> 
            
            <p>If you'd like to share some best practice and have it added to this page we recommend you <a href="https://lists.ubuntu.com/mailman/listinfo/juju">post to the mailing list</a> with some ideas on what you'd like to see added. Ideally we'd like to document all sorts of great ideas on how people are using Juju.</p>
            
            <h2>Juju Best Practices and Tips from Canonical's Infrastructure Team</h2>
            
            <aside>Since Canonical IS uses Juju in production they have certain requirements from charms in order for them to run on a production OpenStack deployment. Though these are requirements for use inside Canonical, charms are not required to meet these criteria to be in the Charm Store, they are included here to share with the devops community.</aside>
            
            <p>Tips for production usage:</p>
            <ul>
              <li>Provide an overview of the service in the README and metadata. </li>
              <li>Use packaged software (i.e. debian packages) where possible, and "backport" any packages needed outside of the archives from whatever PPA you have them to an internal accessible repository.</li>
              <li>Do not duplicate any service components for which there are pre-existing charms.</li>
              <li>Follow the coding guidelines for charms (see below).</li>
              <li>Assemble code for your application outside of the Charm.</li>            
              <li>Create a <code>/srv/${external-service-name}/${instance-type}/${service-name}</code> directory for the code itself, and <code>/srv/${external-service-name}/{${instance-type}-logs,scripts,etc,var}</code> as needed.</li>
              <li>Ensure the owner of the code isn't the same user than runs the code</li>
              <li>Create monitoring checks for your application.</li>
              <li>Which checks are prompt-critical (in other words, constitutes a user-affecting outage that would warrant waking an "oncall" sysadmin over a weekend)?</li>              
              <li>Confirm what data/logs from the application needs to be made visible to developers, and in what format?</li>
              <li>Some organizations use proxies, do not assume that every port is available, consider using common ports like 80/443 to ensure your charm can run in as many environments as possible. For added flexibility we recommend exposing port configuration in the charm as a config option.</li>
            </ul>
            
            <h2>Charm Coding Guidelines</h2>
            
            <p>If written in Bash:</p>
            <ul>
              <li> <code>{variable}-value</code> rather than <code>$variable-value</code>?</li>
              <li> <code>$(COMMAND)</code> vs. <code>COMMAND</code>?</li>
              <li>Use <code>install</code> rather than <code>mkdir; chown</code>
            </ul>
            <p>If written in Python:</p>
            <ul>
              <li>Has <code>pep8</code> been run against the relevant scripts?</li>
              <li>Separation of code from content (i.e. all external files/templates are in the "files" or "templates" directory)?</li>
              </li>As an example, this populates a template from any variables in the current environment: <code>cheetah fill --env -p templates/celerymon_conf.tmpl > /etc/init/celerymon.conf</code></li>
            </ul>
            <p>In this example, the template looks like this:
            <pre>
            start on started celeryd
            stop on stopping celeryd
            
            env CODEDIR=$CODE_LOCATION
            env
            PYTHONPATH=$CODE_LOCATION/apps:$CODE_LOCATION:$CODE_LOCATION/lib/python2.7/site-packages
            
            exec sudo -u $USER_CODE_RUNNER sh -c "cd \$CODEDIR;
            PYTHONPATH=\$PYTHONPATH ./certification-manage.py celerycam --pidfile
            /srv/${BASEDIR}/var/celeryev.pid"
            respawn
            </pre>
            <ul>
              <li>Do all config options have appropriate descriptions?</li>
              <li>Are all hooks idempotent?</li>
              <li>No hard coded values for things that may need changing - exposed via config.yaml options</li>
              <li>No hard coding of full paths for system tools/binaries - we should ensure $PATH is set appropriately.</li>
              <li>Has <code>charm proof</code> been run against the charm?</li>
              <li>Has testing of adding units and removing units been done?</li>
              <li>Has testing of changing all config options and verifying they get changed in the application (and applied, i.e. service reloaded if appropriate) been done?</li>
              <li>Any cron entries should be in <code>/etc/cron.d</code> rather than stored in user crontabs.</li>
              <li>This allows for easier visibility of active cronjobs across the whole system, as well as making editing things much easier.</li>
            </ul>
          </article>
        </div>
      </div>
    </section>
    <div class="shadow"></div>
<!--Footer-->
	<footer class="global clearfix" role="contentinfo">
		<nav role="navigation">
			<div class="footer-a">
				<div class="clearfix">
					<ul>
						<li>
							<h2><a href="/">Juju</a></h2>
							<ul>
								<li><a href="/charms">Charms</a></li>
								<li><a href="/features">Features</a></li>
								<li><a href="/deployment">Deployment</a></li>
							</ul>
						</li>
						<li>
							<h2><a href="/resources">Resources</a></h2>
							<ul>
								<li><a href="/resources/juju-overview/">Overview</a></li>
								<li><a href="/docs/">Documentation</a></li>
								<li><a href="/resources/the-juju-gui/">The Juju web UI</a></li>
								<li><a href="/docs/authors-charm-store.html">The charm store</a></li>
								<li><a href="/docs/getting-started.html#test">Tutorial</a></li>
								<li><a href="/resources/videos/">Videos</a></li>
								<li><a href="/resources/easy-tasks-for-new-developers/">Easy tasks for new developers</a></li>
							</ul>
						</li>
						<li>
							<h2><a href="/community">Community</a></h2>
							<ul>
								<li><a href="/community/juju-blog/">Juju Blog</a></li>
								<li><a href="/events/">Events</a></li>
								<li><a href="/community/weekly-charm-meeting/">Weekly charm meeting</a></li>
								<li><a href="/community/charmers/">Charmers</a></li>
								<li><a href="/docs/authors-charm-writing.html">Write a charm</a></li>
								<li><a href="/docs/">Help with documentation</a></li>
								<li><a href="/labs/">Juju Labs</a></li>
							</ul>
						</li>
						<li>
							<h2><a href="https://jujucharms.com/sidebar/">Try Juju</a></h2>
							<ul>
								<li><a href="https://jujucharms.com/">Charm store</a></li>
								<li><a href="/download/">Download Juju</a></li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</nav>
		<div class="legal clearfix">
			<p>&copy; 2013 Canonical Ltd. Ubuntu and Canonical are registered trademarks of <a href="http://canonical.com">Canonical Ltd</a>.</p>
		</div>
	</footer>

<!--End-Footer-->

<!--Scripts-->
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?skin=sunburst"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.14/jquery-ui.min.js"></script>
    <script src="http://d38yea5fb4e2oh.cloudfront.net/jquery.stacktack.min.js"></script>
    <script type="text/javascript" src="https://juju.ubuntu.com/docs/js/main.js"></script>    
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://assets.ubuntu.com/sites/ubuntu/latest/u/js/plugins/yui-min.js"></script>
    <script src="http://assets.ubuntu.com/sites/ubuntu/latest/u/js/core.js"></script>
    <script src="http://assets.ubuntu.com/sites/ubuntu/latest/u/js/global.js"></script>
<!--End-Scripts-->
</body></html>
