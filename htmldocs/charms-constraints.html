<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Juju Documentation - Using Constraints</title>
  <link href='https://fonts.googleapis.com/css?family=Ubuntu:400,300,300italic,400italic,700,700italic|Ubuntu+Mono' rel='stylesheet' type='text/css' />
  <link rel="stylesheet" type="text/css" media="screen" href="//juju.ubuntu.com/wp-content/themes/juju-website/css/reset.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="//juju.ubuntu.com/wp-content/themes/juju-website/css/960.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="//juju.ubuntu.com/wp-content/themes/juju-website/css/base.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="//juju.ubuntu.com/wp-content/themes/juju-website/css/home-new.css" />
  <link rel='stylesheet' id='stacktack-css'  href='//juju.ubuntu.com/wp-content/plugins/stacktack/css/stacktack.min.css?ver=3.4.2' type='text/css' media='all' />
  <link href="css/main.css?1375975745" rel="stylesheet" type="text/css"/>

  <!--[if lt IE 9]>
  <script type="text/javascript" src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>
  <body class="resources">
    <header class="global clearfix" role="banner">
  <div class="header-navigation">
    <div>
      <nav role="navigation">
        <ul>
          <li class="page_item page-item-6"><a href="https://juju.ubuntu.com/">Home</a></li>
          <li class="page_item page-item-7"><a href="https://juju.ubuntu.com/get-started/">Get started</a></li>
          <li class="page_item page-item-9 current_page_item"><a href="https://juju.ubuntu.com/resources/">Resources</a></li>
          <li class="page_item page-item-13"><a href="https://juju.ubuntu.com/community/">Community</a></li>
          <li class="page_item page-item-3688"><a href="https://juju.ubuntu.com/charm-store/">Charm Store</a></li>
          <li class="page_item page-item-3691"><a href="https://juju.ubuntu.com/events/">Events</a></li>
          <li class="page_item page-item-4474"><a href="https://juju.ubuntu.com/charm-championship/">Charm Championship</a></li>
          <li class="page_item page-item-4249"><a href="https://juju.ubuntu.com/survey/">Survey</a></li>
          <li>
            <form id="form-search" method="get" action="https://juju.ubuntu.com/">
              <fieldset>
                <input id="input-search" type="text" name="s" value="Search" />
              </fieldset>
            </form>
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <div class="header-content">
    <div class="clearfix">
      <img src="https://juju.ubuntu.com/wp-content/themes/juju-website/img/arrow-nav.png" width="9" height="5" style="left:455px; display: block;" class="arrow-nav">
      <div class="header-navigation-secondary"></div>
      <div class="header-image"></div>
      <h1>Resources</h1>
      <h2>A collection of some of the most important online references for Juju users and developers.</h2>
    </div>
  </div>
</header>

    <section id="content" class="container-12">
      <div class="grid-12 doc-container">
        <div id="navlinks" class="grid-3 doc-navigation">LINKS</div>
        <div class="grid-9 doc-content">
          <article>
            <section id ="charms-constraints">
              <h1>Machine Constraints</h1>
              <p>Machine constraints allow you to pick the hardware to which your services will be deployed.</p>
              <p>Constraints can be set for environments and services, with lookups for each key falling back from more specific to more general settings, and with default values set by juju when otherwise unspecified. Changes to constraints do not affect any unit that has already been assigned to a machine.</p>
              <p>Constraints will be controlled with a new command, <code>juju set-constraints</code>, taking an optional <code>--service</code> arg, and any number of <code>key=value</code> pairs. When the service name is specified, the constraints are set on that service; otherwise they are set on the environment.</p>
              <p>Valid choices for the <code>value</code> are generally dependent on the particular constraint, with two exceptions:</p>
              
              <ul>
                <li>An empty value always means &quot;use the juju default setting&quot;. This allows you to ignore environment settings at the service level without having to explicitly remember and re-set the juju default values. Note that there is no way to change the juju default values.</li>
                <li>A value of <code>any</code> explicitly unsets a constraint, and will cause it to be chosen completely arbitrarily.</li>
              </ul>
              
              <p>We also extend the syntax for <code>juju deploy</code>, and <code>juju bootstrap</code>, such that <code>--constraints</code> expects a single string of space-separated constraints, understood as above; deployment constraints will be set on the service before the first unit is deployed, and bootstrap constraints will be set on the environment and used to provision the initial master machine.</p>
              <p>Please note that there are no changes to the <code>juju add-unit</code> command; juju is explicitly focused on <strong>service</strong> orchestration, and it is counterproductive to encourage users to consider individual units. This can be worked around by setting new service constraints before adding new units, but is not encouraged.</p>
              <p>The new <code>juju get-constraints</code> command is used to see the currently applicable constraints. When called without arguments, it outputs the environment constraints as a single yaml-formatted dict; alternatively, it can be called with any number of arguments referencing any mix of services, service units, or machines, and will output a yaml-formatted dict of dicts with the outer dict keyed on the requested entities.</p>
              <h2>Examples</h2>
              <p>Deploy MySQL on a machine with at least 32GiB of RAM, and at least 8 ECU of CPU power (architecture will be inherited from the environment, or default to amd64):</p>
              <pre class="prettyprint">juju deploy --constraints "cpu-cores=8 mem=32G" mysql</pre>
              
              <p>Deploy to t1.micros on AWS:</p>
              <pre class="prettyprint">juju bootstrap --constraints "cpu-power=0 cpu-power=0 mem=512M"</pre>
              
              <p>Launch all future &quot;mysql&quot; machines with at least 8GiB of RAM and 4 ECU:</p>
              <pre class="prettyprint">juju set-constraints --service mysql mem=8G cpu-cores=4</pre>
              
              <p>Output current environment constraints:</p>
              <pre class="prettyprint">juju get-constraints</pre>
              
              <p>Output constraints for machine 3, service &quot;mysql&quot;, and service unit &quot;wordpress/7&quot;:</p>
              <pre class="prettyprint">juju get-constraints 3 mysql wordpress/7</pre>
            </section>
            <section id="provider-constraints">
              <h1>Provider Constraints</h1>
              <p>See a <a href="reference-constraints.html">complete listing of constraints</a> for details on what each constraint means. Two of the most commonly used are:</p>
              <ul>
                <li><code>cpu-cores</code>: The minimum processing power of the machine, roughly indicated by how many cores are available.</li>
                <li><code>mem</code>: The minimum memory for the machine, defaulting to 512MB.</li>
              </ul>
              <p class="note"><strong> Note: </strong> The <code>instance-type</code> constraint is not currently supported by juju-core, but support will be added soon. Some of the following examples make use of this setting merely to illustrate a point. </p>
            </section>
            <section id="examples-constraints">
              <h1>Working with constraints</h1>
              <p>Here are some examples of working with constraints.</p>
              <p>When bootstrapping an environment, you can set the constraints directly:</p>
              <pre class="prettyprint">juju bootstrap --constraints arch=i386</pre>
              
              <p>The above command did two things:</p>
              
              <ul>
              <li><p class="first">Set the environment constraints to require machines with an i386 architecture, leaving the other defaults untouched; this is precisely equivalent to:</p>
              <pre class="prettyprint">juju bootstrap --constraints "arch=i386 cpu-cores= mem= "</pre>
              <p>...but rather more convenient to type.</p>
              </li>
              <li><p class="first">Started the bootstrap/master machine with the above constraints.</p>
              </li>
              </ul>
              <p>Because the environment constraints were set, subsequent deployments will use the same values:</p>
              <pre class="prettyprint">juju deploy mysql</pre>
              
              <p>...but other services can be started with their own constraints:</p>
              <pre class="prettyprint">juju deploy wordpress --constraints mem=1024</pre>
              
              <p>Note that the <code>arch=i386</code> constraint is still inherited from the environment, and that this presents a potential problem:</p>
              <pre class="prettyprint lang-yaml">juju deploy minecraft --constraints instance-type=cc2.8xlarge</pre>
              
              <p>The above command will still inherit the environment constraints, and will lead to an undeployable service (because cc2.8xlarge cannot run on i386). Running juju debug-log will expose the problem; you can fix it as follows:</p>
              
<pre class="prettyprint lang-yaml">
juju remove-unit minecraft/0
juju terminate-machine 1
juju set-constraints --service minecraft arch=amd64 instance-type=cc2.8xlarge
juju add-unit minecraft
</pre>
              
              <p>(You need to remove machine 1's assigned unit before you can terminate it; you need to explicitly terminate the machine to stop the provisioning agent from continuing to attempt to launch it; and you need to set the new service constraints before adding a new unit that will use those constraints.)</p>
              
              <p>Work on the constraints feature is ongoing, and it will shortly become impossible to specify knowably inconsistent constraints; but it is in general impossible to detect undeployable constraints with absolute certainty (for example, you could deploy with <code>ec2-zone=a</code> and be running perfectly happily, but see us-east-1a suddenly go down just as you add a unit).</p>

              <h1>Distinctions Between Entities</h1>
              <p>As noted, it is impossible to directly set constraints on machines or service units; however, it is still possible to call <code>juju get-constraints</code> on those entities. In either case, the constraints are a snapshot of the applicable constraints at entity creation time; so the unit constraints are the combined environment/service constraints from the time at which the unit was created, and the machine constraints are a copy of the unit constraints at that same point in time.</p>
              
              <p>Storing this data allows us to automatically reprovision unexpectedly dead machines (for example, if you terminate machine 7 via the AWS management console, the provisioning agent will spin up a new instance with the same constraints and redeploy the assigned units); and making the data available via the CLI gives you visibility into the state of your deployment, and allows you to answer questions like &quot;why is this unit running on that machine?&quot;.</p>
              
              <h1>Legacy Deployments</h1>
              <p>Attempting to use constraints against a deployment that predates their inclusion in juju will not work, because the running legacy code (specifically, the provisioning agent) will not be able to interpret them. Therefore, attempts to specify constraints against legacy deployments will generate errors to inform users of their invalidity; at the agent level they are simply ignored.</p>
              <p>All commands valid before the client upgrade should continue to work as before, as will the EC2 <code>default-image-id</code> and <code>default-instance-type</code> environment settings.</p>
          </article>
        </div>
      </div>
    </section>
    <div class="shadow"></div>
    <footer class="global clearfix" role="contentinfo">
  <div class="row">
    <div class="inner-wrapper">
      <nav role="navigation" class="clearfix">
        <ul class="footer-a">
          <li class="grid-3 first-col">
            <h4><a href="/get-started">Get started</a></h4>
            <ul>
              <li class="page_item page-item-20"><a href="https://juju.ubuntu.com/get-started/local/">Local</a></li>
              <li class="page_item page-item-22"><a href="https://juju.ubuntu.com/get-started/amazon/">Amazon Web Services</a></li>
              <li class="page_item page-item-18"><a href="https://juju.ubuntu.com/get-started/hp-cloud/">HP Cloud</a></li>
              <li class="page_item page-item-16"><a href="https://juju.ubuntu.com/get-started/rackspace/">Rackspace</a></li>
              <li class="page_item page-item-3596"><a href="https://juju.ubuntu.com/get-started/openstack/">Openstack</a></li>
              <li class="page_item page-item-3600"><a href="https://juju.ubuntu.com/get-started/maas/">MAAS</a></li>
            </ul>
          </li>
          <li class="grid-3">
            <h4><a href="/resources">Resources</a></h4>
            <ul>
              <li><a href="http://juju.ubuntu.com/docs">Documentation</a></li>
              <li><a href="/resources/videos/">Videos</a></li>
              <li><a href="http://uistage.jujucharms.com:8080/">Juju GUI demo site</a></li>
            </ul>
          </li>
          <li class="grid-3">
            <h4><a href="/community">Community</a></h4>
            <ul>
              <li class="page_item page-item-28"><a href="https://juju.ubuntu.com/community/juju-blog/">Juju Blog</a></li>
              <li class="page_item page-item-4262"><a href="https://juju.ubuntu.com/community/weekly-charm-meeting/">Weekly Charm Meeting</a></li>
              <li class="page_item page-item-4036"><a href="https://juju.ubuntu.com/community/charmers/">Charmers</a></li>
              <li><a href="https://lists.ubuntu.com/mailman/listinfo/juju">Mailing List</a></li>
              <li><a href="http://webchat.freenode.net/?channels=juju">Chat</a></li>
              <li><a href="http://askubuntu.com/questions/tagged/juju?sort=faq&pagesize=50">FAQ</a></li>
            </ul>
          </li>
          <li class="grid-3 last-col">
            <h4><a href="https://launchpad.net/juju">Code</a></h4>
            <ul>
              <li><a href="https://launchpad.net/juju-core">Juju Core</a></li>
              <li><a href="https://launchpad.net/charms">Charms</a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <div class="row no-border">
    <div class="legal inner-wrapper">
      <p>&copy; 2013 Canonical Ltd. Ubuntu and Canonical are registered trademarks of Canonical Ltd.</p>
      <p><a href="https://bugs.launchpad.net/juju-website/+filebug">Report a bug on this site</a></p>
    </div>
  </div>
  <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?skin=sunburst"></script>
</footer>

    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.14/jquery-ui.min.js"></script>
    <script src="//d38yea5fb4e2oh.cloudfront.net/jquery.stacktack.min.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
  </body>
</html>
